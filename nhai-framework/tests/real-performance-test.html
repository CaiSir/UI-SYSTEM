<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHAI æ¡†æ¶çœŸå®æ€§èƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .test-button {
            padding: 8px 16px;
            margin: 5px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-button:hover {
            background: #007bff;
            color: white;
        }
        
        .test-button:disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
        }
        
        .test-result {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #28a745;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .test-result.error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .test-result.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
            color: #856404;
        }
        
        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .performance-table th,
        .performance-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .performance-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .performance-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
        
        .memory-info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ NHAI æ¡†æ¶çœŸå®æ€§èƒ½æµ‹è¯•</h1>
        <p>åŸºäºå®é™…è¿è¡Œæµ‹è¯•çš„æ€§èƒ½å¯¹æ¯”æ•°æ®</p>
        
        <div class="test-section">
            <h3>ğŸ“Š æ€§èƒ½æµ‹è¯•æ§åˆ¶å°</h3>
            <button class="test-button" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="test-button" onclick="testOriginalNHAI()">æµ‹è¯•åŸå§‹ NHAI</button>
            <button class="test-button" onclick="testVanillaJS()">æµ‹è¯•åŸç”Ÿ JavaScript</button>
            <button class="test-button" onclick="testMemoryUsage()">æµ‹è¯•å†…å­˜ä½¿ç”¨</button>
            <button class="test-button" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
            </div>
            
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ˆ æ€§èƒ½å¯¹æ¯”ç»“æœ</h3>
            <table class="performance-table" id="performance-table">
                <thead>
                    <tr>
                        <th>æµ‹è¯•é¡¹ç›®</th>
                        <th>åŸå§‹ NHAI</th>
                        <th>åŸç”Ÿ JavaScript</th>
                        <th>ä¼˜åŒ–å NHAI</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>æ¸²æŸ“ 100 ä¸ªæŒ‰é’®</td>
                        <td id="nhai-100">æœªæµ‹è¯•</td>
                        <td id="vanilla-100">æœªæµ‹è¯•</td>
                        <td id="optimized-100">æœªæµ‹è¯•</td>
                        <td id="status-100">â³ ç­‰å¾…</td>
                    </tr>
                    <tr>
                        <td>æ¸²æŸ“ 500 ä¸ªæŒ‰é’®</td>
                        <td id="nhai-500">æœªæµ‹è¯•</td>
                        <td id="vanilla-500">æœªæµ‹è¯•</td>
                        <td id="optimized-500">æœªæµ‹è¯•</td>
                        <td id="status-500">â³ ç­‰å¾…</td>
                    </tr>
                    <tr>
                        <td>æ¸²æŸ“ 1000 ä¸ªæŒ‰é’®</td>
                        <td id="nhai-1000">æœªæµ‹è¯•</td>
                        <td id="vanilla-1000">æœªæµ‹è¯•</td>
                        <td id="optimized-1000">æœªæµ‹è¯•</td>
                        <td id="status-1000">â³ ç­‰å¾…</td>
                    </tr>
                    <tr>
                        <td>å†…å­˜ä½¿ç”¨ (MB)</td>
                        <td id="nhai-memory">æœªæµ‹è¯•</td>
                        <td id="vanilla-memory">æœªæµ‹è¯•</td>
                        <td id="optimized-memory">æœªæµ‹è¯•</td>
                        <td id="status-memory">â³ ç­‰å¾…</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h3>ğŸ’¾ å†…å­˜ç›‘æ§</h3>
            <div class="memory-info" id="memory-info">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ NHAI æ¡†æ¶
        class MockNHAIButton {
            constructor(props = {}) {
                this.props = props
                this.element = null
            }
            
            render() {
                this.element = document.createElement('button')
                this.element.textContent = this.props.children || 'NHAI Button'
                this.element.style.padding = '8px 16px'
                this.element.style.margin = '2px'
                this.element.style.border = '1px solid #007bff'
                this.element.style.backgroundColor = 'white'
                this.element.style.color = '#007bff'
                this.element.style.borderRadius = '4px'
                this.element.style.cursor = 'pointer'
                
                if (this.props.onClick) {
                    this.element.addEventListener('click', this.props.onClick)
                }
                
                return this.element
            }
            
            destroy() {
                if (this.element && this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element)
                }
            }
        }
        
        // ä¼˜åŒ–åçš„ NHAI æŒ‰é’®ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
        class OptimizedNHAIButton {
            constructor(props = {}) {
                this.props = props
                this.element = null
                this.cachedStyle = null
            }
            
            getCachedStyle() {
                if (!this.cachedStyle) {
                    this.cachedStyle = {
                        padding: '8px 16px',
                        margin: '2px',
                        border: '1px solid #007bff',
                        backgroundColor: 'white',
                        color: '#007bff',
                        borderRadius: '4px',
                        cursor: 'pointer'
                    }
                }
                return this.cachedStyle
            }
            
            render() {
                this.element = document.createElement('button')
                this.element.textContent = this.props.children || 'Optimized Button'
                
                // ä½¿ç”¨ç¼“å­˜çš„æ ·å¼
                const style = this.getCachedStyle()
                Object.assign(this.element.style, style)
                
                if (this.props.onClick) {
                    this.element.addEventListener('click', this.props.onClick)
                }
                
                return this.element
            }
            
            destroy() {
                if (this.element && this.element.parentNode) {
                    this.element.parentNode.removeChild(this.element)
                }
            }
        }
        
        // åŸç”Ÿ JavaScript æŒ‰é’®
        function createVanillaButton(text, onClick) {
            const button = document.createElement('button')
            button.textContent = text
            button.style.padding = '8px 16px'
            button.style.margin = '2px'
            button.style.border = '1px solid #28a745'
            button.style.backgroundColor = 'white'
            button.style.color = '#28a745'
            button.style.borderRadius = '4px'
            button.style.cursor = 'pointer'
            
            if (onClick) {
                button.addEventListener('click', onClick)
            }
            
            return button
        }
        
        // æ€§èƒ½æµ‹è¯•å·¥å…·
        class PerformanceTester {
            constructor() {
                this.results = {}
                this.testContainer = null
            }
            
            // è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
            getMemoryUsage() {
                if (performance.memory) {
                    return {
                        used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                        total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024),
                        limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024)
                    }
                }
                return null
            }
            
            // æ›´æ–°å†…å­˜ä¿¡æ¯æ˜¾ç¤º
            updateMemoryInfo() {
                const memoryInfo = document.getElementById('memory-info')
                const memory = this.getMemoryUsage()
                
                if (memory) {
                    memoryInfo.innerHTML = `
                        å·²ä½¿ç”¨: ${memory.used}MB | 
                        æ€»è®¡: ${memory.total}MB | 
                        é™åˆ¶: ${memory.limit}MB
                    `
                } else {
                    memoryInfo.innerHTML = 'å†…å­˜ä¿¡æ¯ä¸å¯ç”¨ï¼ˆéœ€è¦ Chrome æµè§ˆå™¨ï¼‰'
                }
            }
            
            // æ¸…ç†æµ‹è¯•å®¹å™¨
            clearTestContainer() {
                if (this.testContainer) {
                    this.testContainer.remove()
                }
                this.testContainer = document.createElement('div')
                this.testContainer.style.position = 'absolute'
                this.testContainer.style.left = '-9999px'
                this.testContainer.style.top = '-9999px'
                document.body.appendChild(this.testContainer)
            }
            
            // è¿è¡Œæµ‹è¯•
            async runTest(testName, testFunction, count) {
                const startTime = performance.now()
                const startMemory = this.getMemoryUsage()
                
                // æ¸…ç†ä¹‹å‰çš„æµ‹è¯•
                this.clearTestContainer()
                
                // è¿è¡Œæµ‹è¯•
                const elements = await testFunction(count)
                
                const endTime = performance.now()
                const endMemory = this.getMemoryUsage()
                
                // æ¸…ç†å…ƒç´ 
                elements.forEach(element => {
                    if (element && element.destroy) {
                        element.destroy()
                    } else if (element && element.parentNode) {
                        element.parentNode.removeChild(element)
                    }
                })
                
                const duration = endTime - startTime
                const memoryDiff = endMemory ? endMemory.used - startMemory.used : 0
                
                return {
                    duration: Math.round(duration * 100) / 100,
                    memoryDiff: memoryDiff,
                    count: count
                }
            }
            
            // æµ‹è¯•åŸå§‹ NHAI
            async testOriginalNHAI(count) {
                const elements = []
                for (let i = 0; i < count; i++) {
                    const button = new MockNHAIButton({
                        children: `NHAI Button ${i + 1}`,
                        onClick: () => console.log(`NHAI Button ${i + 1} clicked`)
                    })
                    const element = button.render()
                    this.testContainer.appendChild(element)
                    elements.push(button)
                }
                return elements
            }
            
            // æµ‹è¯•ä¼˜åŒ–åçš„ NHAI
            async testOptimizedNHAI(count) {
                const elements = []
                for (let i = 0; i < count; i++) {
                    const button = new OptimizedNHAIButton({
                        children: `Optimized Button ${i + 1}`,
                        onClick: () => console.log(`Optimized Button ${i + 1} clicked`)
                    })
                    const element = button.render()
                    this.testContainer.appendChild(element)
                    elements.push(button)
                }
                return elements
            }
            
            // æµ‹è¯•åŸç”Ÿ JavaScript
            async testVanillaJS(count) {
                const elements = []
                for (let i = 0; i < count; i++) {
                    const button = createVanillaButton(
                        `Vanilla Button ${i + 1}`,
                        () => console.log(`Vanilla Button ${i + 1} clicked`)
                    )
                    this.testContainer.appendChild(button)
                    elements.push(button)
                }
                return elements
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgress(percent) {
                const progressBar = document.getElementById('progress-bar')
                progressBar.style.width = percent + '%'
            }
            
            // æ›´æ–°ç»“æœè¡¨æ ¼
            updateResult(testType, count, result) {
                const cellId = `${testType}-${count}`
                const statusId = `status-${count}`
                
                const cell = document.getElementById(cellId)
                const status = document.getElementById(statusId)
                
                if (cell) {
                    cell.textContent = `${result.duration}ms`
                    cell.style.color = result.duration < 50 ? '#28a745' : result.duration < 100 ? '#ffc107' : '#dc3545'
                }
                
                if (status) {
                    status.textContent = 'âœ… å®Œæˆ'
                    status.style.color = '#28a745'
                }
            }
            
            // æ·»åŠ æµ‹è¯•ç»“æœåˆ°æ§åˆ¶å°
            addTestResult(testName, result) {
                const resultsDiv = document.getElementById('test-results')
                const resultDiv = document.createElement('div')
                resultDiv.className = 'test-result'
                resultDiv.innerHTML = `
                    <strong>${testName}</strong><br>
                    æ¸²æŸ“ ${result.count} ä¸ªæŒ‰é’®è€—æ—¶: ${result.duration}ms<br>
                    å†…å­˜å˜åŒ–: ${result.memoryDiff > 0 ? '+' : ''}${result.memoryDiff}MB<br>
                    å¹³å‡æ¯ä¸ªæŒ‰é’®: ${(result.duration / result.count).toFixed(2)}ms
                `
                resultsDiv.appendChild(resultDiv)
            }
        }
        
        // å…¨å±€æµ‹è¯•å™¨å®ä¾‹
        const tester = new PerformanceTester()
        
        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.runAllTests = async function() {
            const resultsDiv = document.getElementById('test-results')
            resultsDiv.innerHTML = '<div class="test-result">ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...</div>'
            
            const testCounts = [100, 500, 1000]
            let progress = 0
            const totalTests = testCounts.length * 3 // 3ç§æµ‹è¯•ç±»å‹
            
            for (const count of testCounts) {
                // æµ‹è¯•åŸå§‹ NHAI
                tester.updateProgress((progress / totalTests) * 100)
                const nhaiResult = await tester.runTest('NHAI', tester.testOriginalNHAI.bind(tester), count)
                tester.updateResult('nhai', count, nhaiResult)
                tester.addTestResult(`åŸå§‹ NHAI (${count}ä¸ªæŒ‰é’®)`, nhaiResult)
                progress++
                
                // ç­‰å¾…ä¸€ä¸‹ï¼Œé¿å…å†…å­˜å½±å“
                await new Promise(resolve => setTimeout(resolve, 100))
                
                // æµ‹è¯•åŸç”Ÿ JavaScript
                tester.updateProgress((progress / totalTests) * 100)
                const vanillaResult = await tester.runTest('Vanilla', tester.testVanillaJS.bind(tester), count)
                tester.updateResult('vanilla', count, vanillaResult)
                tester.addTestResult(`åŸç”Ÿ JavaScript (${count}ä¸ªæŒ‰é’®)`, vanillaResult)
                progress++
                
                // ç­‰å¾…ä¸€ä¸‹
                await new Promise(resolve => setTimeout(resolve, 100))
                
                // æµ‹è¯•ä¼˜åŒ–åçš„ NHAI
                tester.updateProgress((progress / totalTests) * 100)
                const optimizedResult = await tester.runTest('Optimized', tester.testOptimizedNHAI.bind(tester), count)
                tester.updateResult('optimized', count, optimizedResult)
                tester.addTestResult(`ä¼˜åŒ–å NHAI (${count}ä¸ªæŒ‰é’®)`, optimizedResult)
                progress++
                
                // ç­‰å¾…ä¸€ä¸‹
                await new Promise(resolve => setTimeout(resolve, 200))
            }
            
            tester.updateProgress(100)
            tester.updateMemoryInfo()
            
            // æ·»åŠ æ€»ç»“
            const summaryDiv = document.createElement('div')
            summaryDiv.className = 'test-result'
            summaryDiv.innerHTML = `
                <strong>ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼</strong><br>
                æµ‹è¯•ç»“æœå·²æ›´æ–°åˆ°ä¸Šæ–¹çš„æ€§èƒ½å¯¹æ¯”è¡¨æ ¼ä¸­ã€‚<br>
                ç»¿è‰²è¡¨ç¤ºæ€§èƒ½ä¼˜ç§€ï¼Œé»„è‰²è¡¨ç¤ºæ€§èƒ½è‰¯å¥½ï¼Œçº¢è‰²è¡¨ç¤ºéœ€è¦ä¼˜åŒ–ã€‚
            `
            resultsDiv.appendChild(summaryDiv)
        }
        
        window.testOriginalNHAI = async function() {
            const count = 100
            const result = await tester.runTest('NHAI', tester.testOriginalNHAI.bind(tester), count)
            tester.addTestResult(`åŸå§‹ NHAI (${count}ä¸ªæŒ‰é’®)`, result)
            tester.updateMemoryInfo()
        }
        
        window.testVanillaJS = async function() {
            const count = 100
            const result = await tester.runTest('Vanilla', tester.testVanillaJS.bind(tester), count)
            tester.addTestResult(`åŸç”Ÿ JavaScript (${count}ä¸ªæŒ‰é’®)`, result)
            tester.updateMemoryInfo()
        }
        
        window.testMemoryUsage = function() {
            tester.updateMemoryInfo()
        }
        
        window.clearResults = function() {
            document.getElementById('test-results').innerHTML = ''
            document.getElementById('progress-bar').style.width = '0%'
            
            // é‡ç½®è¡¨æ ¼
            const counts = [100, 500, 1000]
            const types = ['nhai', 'vanilla', 'optimized']
            
            counts.forEach(count => {
                types.forEach(type => {
                    const cell = document.getElementById(`${type}-${count}`)
                    if (cell) {
                        cell.textContent = 'æœªæµ‹è¯•'
                        cell.style.color = ''
                    }
                })
                
                const status = document.getElementById(`status-${count}`)
                if (status) {
                    status.textContent = 'â³ ç­‰å¾…'
                    status.style.color = ''
                }
            })
            
            document.getElementById('memory-info').innerHTML = 'ç­‰å¾…æµ‹è¯•å¼€å§‹...'
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            tester.updateMemoryInfo()
            console.log('NHAI æ€§èƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½')
        })
    </script>
</body>
</html>
