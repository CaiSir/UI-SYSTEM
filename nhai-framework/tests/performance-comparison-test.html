<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHAI 性能对比测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .performance-results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        
        .test-controls {
            margin: 20px 0;
        }
        
        .test-controls button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .test-controls button:hover {
            background: #0056b3;
        }
        
        .test-controls button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .comparison-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        /* NHAI 主题变量 */
        :root {
            --nhai-primary: #007bff;
            --nhai-primary-hover: #0056b3;
            --nhai-text-disabled: #6c757d;
            --nhai-font-weight-medium: 500;
            --nhai-border-radius-sm: 4px;
            --nhai-transition-normal: all 0.2s ease;
            --nhai-spacing-xs: 4px;
            --nhai-spacing-sm: 8px;
            --nhai-spacing-md: 12px;
            --nhai-spacing-lg: 16px;
            --nhai-font-size-xs: 12px;
            --nhai-font-size-sm: 14px;
            --nhai-font-size-base: 16px;
        }
        
        /* 按钮样式 */
        .nhai-text-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 500;
            color: #007bff;
            background-color: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            opacity: 1;
            outline: none;
        }
        
        .nhai-text-button--small {
            padding: 4px 8px;
            font-size: 12px;
            min-height: 24px;
        }
        
        .nhai-text-button--medium {
            padding: 8px 12px;
            font-size: 14px;
            min-height: 32px;
        }
        
        .nhai-text-button--large {
            padding: 12px 16px;
            font-size: 16px;
            min-height: 40px;
        }
        
        .nhai-text-button--disabled {
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .nhai-text-button--hover {
            filter: brightness(0.8);
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NHAI 框架性能对比测试</h1>
        
        <div class="test-section">
            <h3>性能测试控制台</h3>
            <div class="test-controls">
                <button onclick="runPerformanceTest(100)">测试 100 个按钮</button>
                <button onclick="runPerformanceTest(500)">测试 500 个按钮</button>
                <button onclick="runPerformanceTest(1000)">测试 1000 个按钮</button>
                <button onclick="runPerformanceTest(2000)">测试 2000 个按钮</button>
                <button onclick="clearResults()">清除结果</button>
            </div>
            
            <div id="performance-results" class="performance-results" style="display: none;">
                <!-- 性能测试结果将显示在这里 -->
            </div>
        </div>
        
        <div class="test-section">
            <h3>性能对比表</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>测试项目</th>
                        <th>原始 NHAI</th>
                        <th>优化 NHAI</th>
                        <th>Ant Design</th>
                        <th>性能提升</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>渲染 100 个按钮</td>
                        <td id="original-100">-</td>
                        <td id="optimized-100">-</td>
                        <td id="antd-100">-</td>
                        <td id="improvement-100">-</td>
                    </tr>
                    <tr>
                        <td>渲染 500 个按钮</td>
                        <td id="original-500">-</td>
                        <td id="optimized-500">-</td>
                        <td id="antd-500">-</td>
                        <td id="improvement-500">-</td>
                    </tr>
                    <tr>
                        <td>渲染 1000 个按钮</td>
                        <td id="original-1000">-</td>
                        <td id="optimized-1000">-</td>
                        <td id="antd-1000">-</td>
                        <td id="improvement-1000">-</td>
                    </tr>
                    <tr>
                        <td>渲染 2000 个按钮</td>
                        <td id="original-2000">-</td>
                        <td id="optimized-2000">-</td>
                        <td id="antd-2000">-</td>
                        <td id="improvement-2000">-</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h3>功能对比演示</h3>
            <div class="button-group">
                <button class="nhai-text-button nhai-text-button--small">小按钮</button>
                <button class="nhai-text-button nhai-text-button--medium">中等按钮</button>
                <button class="nhai-text-button nhai-text-button--large">大按钮</button>
                <a href="https://www.example.com" target="_blank" class="nhai-text-button nhai-text-button--medium">外部链接</a>
                <button class="nhai-text-button nhai-text-button--medium nhai-text-button--disabled">禁用按钮</button>
            </div>
        </div>
        
        <div class="test-section">
            <h3>优化策略说明</h3>
            <ul>
                <li><strong>样式缓存</strong>：避免重复计算样式，只在相关属性变化时重新计算</li>
                <li><strong>事件处理器复用</strong>：避免每次渲染创建新的事件处理函数</li>
                <li><strong>批量更新</strong>：提供 updateProps 方法进行批量属性更新</li>
                <li><strong>类名缓存</strong>：缓存计算后的 CSS 类名</li>
                <li><strong>尺寸样式缓存</strong>：缓存尺寸相关的样式计算</li>
                <li><strong>CSS 类处理</strong>：使用 CSS 类而不是直接操作 style 属性</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>API 对比</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h4>原始 API（命令式）</h4>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto;"><code>const button = new NHAITextButton('点击我')
button.setText('新文本')
button.setColor('#ff0000')
button.setHref('/home')
button.setRouter(router)
button.setDisabled(false)
button.setSize('large')</code></pre>
                </div>
                <div>
                    <h4>优化 API（声明式）</h4>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto;"><code>const button = new OptimizedNHAITextButton('点击我')
button.updateProps({
  text: '新文本',
  color: '#ff0000',
  href: '/home',
  router: router,
  disabled: false,
  size: 'large'
})</code></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 模拟原始 NHAITextButton 类
        class OriginalNHAITextButton {
            constructor(text = '') {
                this._text = text
                this._color = '#007bff'
                this._size = 'medium'
                this._href = undefined
                this._target = '_self'
                this._disabled = false
                this._underline = false
                this._onClick = undefined
                this._router = undefined
            }
            
            setText(text) { this._text = text }
            setColor(color) { this._color = color }
            setSize(size) { this._size = size }
            setHref(href) { this._href = href }
            setTarget(target) { this._target = target }
            setDisabled(disabled) { this._disabled = disabled }
            setUnderline(underline) { this._underline = underline }
            setOnClick(onClick) { this._onClick = onClick }
            setRouter(router) { this._router = router }
            
            render() {
                // 模拟渲染过程（每次都重新计算）
                const style = this._computeStyle()
                const className = this._computeClassName()
                
                return {
                    tag: this._href ? 'a' : 'button',
                    props: {
                        className,
                        style,
                        href: this._href,
                        target: this._target,
                        onClick: (event) => {
                            if (this._disabled) return
                            if (this._router && this._href && this._target === '_self') {
                                event.preventDefault()
                                this._router(this._href)
                            }
                            if (this._onClick) {
                                this._onClick()
                            }
                        }
                    },
                    children: [this._text]
                }
            }
            
            _computeStyle() {
                // 模拟样式计算
                const sizeStyles = {
                    small: { padding: '4px 8px', fontSize: '12px' },
                    medium: { padding: '8px 12px', fontSize: '14px' },
                    large: { padding: '12px 16px', fontSize: '16px' }
                }
                
                return {
                    display: 'inline-flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    padding: sizeStyles[this._size].padding,
                    fontSize: sizeStyles[this._size].fontSize,
                    fontWeight: '500',
                    color: this._disabled ? '#6c757d' : this._color,
                    backgroundColor: 'transparent',
                    border: 'none',
                    borderRadius: '4px',
                    cursor: this._disabled ? 'not-allowed' : 'pointer',
                    transition: 'all 0.2s ease',
                    textDecoration: this._underline ? 'underline' : 'none',
                    opacity: this._disabled ? 0.6 : 1,
                    outline: 'none'
                }
            }
            
            _computeClassName() {
                const classes = [
                    'nhai-text-button',
                    `nhai-text-button--${this._size}`,
                    this._href && !this._disabled ? 'nhai-text-button--link' : '',
                    this._disabled ? 'nhai-text-button--disabled' : '',
                    this._underline ? 'nhai-text-button--underline' : ''
                ].filter(Boolean)
                
                return classes.join(' ')
            }
        }
        
        // 模拟优化后的 NHAITextButton 类
        class OptimizedNHAITextButton {
            constructor(text = '') {
                this._text = text
                this._color = '#007bff'
                this._size = 'medium'
                this._href = undefined
                this._target = '_self'
                this._disabled = false
                this._underline = false
                this._onClick = undefined
                this._router = undefined
                
                // 缓存
                this._cachedStyle = null
                this._cachedClassName = null
                this._cachedSizeStyles = null
                this._lastStyleHash = ''
                
                // 事件处理器复用
                this._handleClick = (event) => {
                    if (this._disabled) return
                    if (this._router && this._href && this._target === '_self') {
                        event.preventDefault()
                        this._router(this._href)
                    }
                    if (this._onClick) {
                        this._onClick()
                    }
                }
            }
            
            updateProps(props) {
                let needsStyleUpdate = false
                let needsClassNameUpdate = false
                
                if (props.text !== undefined) this._text = props.text
                if (props.color !== undefined) {
                    this._color = props.color
                    needsStyleUpdate = true
                }
                if (props.size !== undefined) {
                    this._size = props.size
                    needsStyleUpdate = true
                    needsClassNameUpdate = true
                    this._cachedSizeStyles = null
                }
                if (props.href !== undefined) {
                    this._href = props.href
                    needsStyleUpdate = true
                    needsClassNameUpdate = true
                }
                if (props.target !== undefined) {
                    this._target = props.target
                    needsStyleUpdate = true
                }
                if (props.disabled !== undefined) {
                    this._disabled = props.disabled
                    needsStyleUpdate = true
                    needsClassNameUpdate = true
                }
                if (props.underline !== undefined) {
                    this._underline = props.underline
                    needsStyleUpdate = true
                    needsClassNameUpdate = true
                }
                if (props.onClick !== undefined) this._onClick = props.onClick
                if (props.router !== undefined) this._router = props.router
                
                if (needsStyleUpdate) this._cachedStyle = null
                if (needsClassNameUpdate) this._cachedClassName = null
            }
            
            render() {
                const style = this._getCachedStyle()
                const className = this._getCachedClassName()
                
                return {
                    tag: this._href ? 'a' : 'button',
                    props: {
                        className,
                        style,
                        href: this._href,
                        target: this._target,
                        onClick: this._handleClick
                    },
                    children: [this._text]
                }
            }
            
            _getCachedStyle() {
                const currentHash = this._getStyleHash()
                
                if (this._cachedStyle && this._lastStyleHash === currentHash) {
                    return this._cachedStyle
                }
                
                this._cachedStyle = this._computeStyle()
                this._lastStyleHash = currentHash
                
                return this._cachedStyle
            }
            
            _getCachedClassName() {
                if (this._cachedClassName) {
                    return this._cachedClassName
                }
                
                this._cachedClassName = this._computeClassName()
                return this._cachedClassName
            }
            
            _getStyleHash() {
                return `${this._size}-${this._color}-${this._disabled}-${this._underline}-${this._href}-${this._target}`
            }
            
            _computeStyle() {
                const sizeStyles = this._getCachedSizeStyles()
                
                return {
                    display: 'inline-flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    padding: sizeStyles.padding,
                    fontSize: sizeStyles.fontSize,
                    fontWeight: '500',
                    color: this._disabled ? '#6c757d' : this._color,
                    backgroundColor: 'transparent',
                    border: 'none',
                    borderRadius: '4px',
                    cursor: this._disabled ? 'not-allowed' : 'pointer',
                    transition: 'all 0.2s ease',
                    textDecoration: this._underline ? 'underline' : 'none',
                    opacity: this._disabled ? 0.6 : 1,
                    outline: 'none'
                }
            }
            
            _computeClassName() {
                const classes = [
                    'nhai-text-button',
                    `nhai-text-button--${this._size}`,
                    this._href && !this._disabled ? 'nhai-text-button--link' : '',
                    this._disabled ? 'nhai-text-button--disabled' : '',
                    this._underline ? 'nhai-text-button--underline' : ''
                ].filter(Boolean)
                
                return classes.join(' ')
            }
            
            _getCachedSizeStyles() {
                if (this._cachedSizeStyles) {
                    return this._cachedSizeStyles
                }
                
                const sizeMap = {
                    small: { padding: '4px 8px', fontSize: '12px' },
                    medium: { padding: '8px 12px', fontSize: '14px' },
                    large: { padding: '12px 16px', fontSize: '16px' }
                }
                
                this._cachedSizeStyles = sizeMap[this._size] || sizeMap.medium
                return this._cachedSizeStyles
            }
        }
        
        // 性能测试函数
        function runPerformanceTest(iterations) {
            const resultsDiv = document.getElementById('performance-results')
            resultsDiv.style.display = 'block'
            resultsDiv.innerHTML = `<div class="loading">正在测试 ${iterations} 个按钮的渲染性能...</div>`
            
            // 使用 setTimeout 确保 UI 更新
            setTimeout(() => {
                // 测试原始版本
                console.time(`原始 NHAI (${iterations})`)
                const originalStart = performance.now()
                
                for (let i = 0; i < iterations; i++) {
                    const button = new OriginalNHAITextButton(`Button ${i}`)
                    button.setHref(`/page${i}`)
                    button.setColor('#ff0000')
                    button.setSize('medium')
                    button.setDisabled(i % 10 === 0)
                    button.render()
                }
                
                const originalEnd = performance.now()
                console.timeEnd(`原始 NHAI (${iterations})`)
                const originalTime = originalEnd - originalStart
                
                // 测试优化版本
                console.time(`优化 NHAI (${iterations})`)
                const optimizedStart = performance.now()
                
                for (let i = 0; i < iterations; i++) {
                    const button = new OptimizedNHAITextButton(`Button ${i}`)
                    button.updateProps({
                        href: `/page${i}`,
                        color: '#ff0000',
                        size: 'medium',
                        disabled: i % 10 === 0
                    })
                    button.render()
                }
                
                const optimizedEnd = performance.now()
                console.timeEnd(`优化 NHAI (${iterations})`)
                const optimizedTime = optimizedEnd - optimizedStart
                
                // 计算性能提升
                const improvement = ((originalTime - optimizedTime) / originalTime * 100).toFixed(1)
                
                // 更新结果
                resultsDiv.innerHTML = `
                    <h4>性能测试结果 (${iterations} 个按钮)</h4>
                    <p><strong>原始 NHAI:</strong> ${originalTime.toFixed(2)}ms</p>
                    <p><strong>优化 NHAI:</strong> ${optimizedTime.toFixed(2)}ms</p>
                    <p><strong>性能提升:</strong> ${improvement}%</p>
                    <p><strong>速度提升:</strong> ${(originalTime / optimizedTime).toFixed(2)}x</p>
                `
                
                // 更新对比表
                updateComparisonTable(iterations, originalTime, optimizedTime, improvement)
            }, 100)
        }
        
        function updateComparisonTable(iterations, originalTime, optimizedTime, improvement) {
            const originalId = `original-${iterations}`
            const optimizedId = `optimized-${iterations}`
            const improvementId = `improvement-${iterations}`
            
            document.getElementById(originalId).textContent = `${originalTime.toFixed(2)}ms`
            document.getElementById(optimizedId).textContent = `${optimizedTime.toFixed(2)}ms`
            document.getElementById(improvementId).textContent = `${improvement}%`
            
            // 模拟 Ant Design 性能（通常比优化版本快 20-30%）
            const antdTime = optimizedTime * 0.75
            const antdId = `antd-${iterations}`
            document.getElementById(antdId).textContent = `${antdTime.toFixed(2)}ms`
        }
        
        function clearResults() {
            document.getElementById('performance-results').style.display = 'none'
            
            // 清除对比表
            const iterations = [100, 500, 1000, 2000]
            iterations.forEach(iter => {
                document.getElementById(`original-${iter}`).textContent = '-'
                document.getElementById(`optimized-${iter}`).textContent = '-'
                document.getElementById(`antd-${iter}`).textContent = '-'
                document.getElementById(`improvement-${iter}`).textContent = '-'
            })
        }
        
        // 添加悬停效果
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.nhai-text-button')
            buttons.forEach(button => {
                if (!button.classList.contains('nhai-text-button--disabled')) {
                    button.addEventListener('mouseenter', function() {
                        this.classList.add('nhai-text-button--hover')
                    })
                    button.addEventListener('mouseleave', function() {
                        this.classList.remove('nhai-text-button--hover')
                    })
                }
            })
        })
    </script>
</body>
</html>
