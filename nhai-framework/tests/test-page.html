<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHAI 框架测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .test-button {
            padding: 8px 16px;
            margin: 5px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-button:hover {
            background: #007bff;
            color: white;
        }
        
        .test-result {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #28a745;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 NHAI 框架测试页面</h1>
        <p>测试 NHAI 框架的核心功能是否正常工作</p>
        
        <div class="test-section">
            <h3>📦 框架加载测试</h3>
            <button class="test-button" onclick="testFrameworkLoading()">测试框架加载</button>
            <div id="loading-result" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>🔧 组件创建测试</h3>
            <button class="test-button" onclick="testComponentCreation()">测试组件创建</button>
            <div id="component-result" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>🎨 动态组件测试</h3>
            <button class="test-button" onclick="testDynamicComponents()">测试动态组件</button>
            <div id="dynamic-result" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>📊 性能测试</h3>
            <button class="test-button" onclick="testPerformance()">测试性能</button>
            <div id="performance-result" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>🌐 浏览器兼容性测试</h3>
            <button class="test-button" onclick="testBrowserCompatibility()">测试兼容性</button>
            <div id="compatibility-result" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- 加载 NHAI 框架 -->
    <script type="module">
        // 模拟 NHAI 框架的核心功能
        window.NHAI = {
            // 框架版本
            version: '1.0.0',
            
            // 核心组件
            Components: {
                Button: class NHAIButton {
                    constructor(props = {}) {
                        this.props = props
                    }
                    
                    render() {
                        return {
                            tag: 'button',
                            props: {
                                ...this.props,
                                style: {
                                    padding: '8px 16px',
                                    border: '1px solid #007bff',
                                    background: 'white',
                                    color: '#007bff',
                                    borderRadius: '4px',
                                    cursor: 'pointer',
                                    ...this.props.style
                                }
                            },
                            children: this.props.children || 'NHAI Button'
                        }
                    }
                },
                
                TextButton: class NHAITextButton {
                    constructor(props = {}) {
                        this.props = props
                    }
                    
                    render() {
                        return {
                            tag: 'button',
                            props: {
                                ...this.props,
                                style: {
                                    padding: '6px 12px',
                                    border: 'none',
                                    background: 'transparent',
                                    color: '#007bff',
                                    cursor: 'pointer',
                                    textDecoration: 'underline',
                                    ...this.props.style
                                }
                            },
                            children: this.props.children || 'NHAI Text Button'
                        }
                    }
                }
            },
            
            // 动态组件系统
            DynamicComponents: {
                Registry: {
                    components: new Map(),
                    
                    registerComponent(name, componentClass) {
                        this.components.set(name, componentClass)
                    },
                    
                    createComponent(name, props = {}) {
                        const ComponentClass = this.components.get(name)
                        if (!ComponentClass) {
                            throw new Error(`Component "${name}" not found`)
                        }
                        return new ComponentClass(props)
                    },
                    
                    hasComponent(name) {
                        return this.components.has(name)
                    }
                },
                
                Renderer: {
                    renderDynamicComponent(componentName, props = {}) {
                        try {
                            const component = window.NHAI.DynamicComponents.Registry.createComponent(componentName, props)
                            return component.render()
                        } catch (error) {
                            return {
                                tag: 'div',
                                props: {
                                    style: {
                                        padding: '10px',
                                        backgroundColor: '#ffebee',
                                        border: '1px solid #f44336',
                                        borderRadius: '4px',
                                        color: '#c62828'
                                    }
                                },
                                children: [`Error: ${error.message}`]
                            }
                        }
                    }
                }
            },
            
            // 工具函数
            Utils: {
                createElement(tag, props = {}, children = []) {
                    const element = document.createElement(tag)
                    
                    // 设置属性
                    Object.keys(props).forEach(key => {
                        if (key === 'style' && typeof props[key] === 'object') {
                            Object.assign(element.style, props[key])
                        } else if (key === 'className') {
                            element.className = props[key]
                        } else if (key.startsWith('on')) {
                            element.addEventListener(key.slice(2).toLowerCase(), props[key])
                        } else {
                            element.setAttribute(key, props[key])
                        }
                    })
                    
                    // 添加子元素
                    if (Array.isArray(children)) {
                        children.forEach(child => {
                            if (typeof child === 'string') {
                                element.appendChild(document.createTextNode(child))
                            } else if (child && typeof child === 'object') {
                                const childElement = window.NHAI.Utils.createElement(child.tag, child.props, child.children)
                                element.appendChild(childElement)
                            }
                        })
                    } else if (typeof children === 'string') {
                        element.appendChild(document.createTextNode(children))
                    }
                    
                    return element
                },
                
                renderComponent(component) {
                    if (component && typeof component.render === 'function') {
                        const result = component.render()
                        return window.NHAI.Utils.createElement(result.tag, result.props, result.children)
                    }
                    return document.createElement('div')
                }
            }
        }
        
        // 全局测试函数
        window.testFrameworkLoading = function() {
            const resultDiv = document.getElementById('loading-result')
            resultDiv.style.display = 'block'
            
            try {
                if (window.NHAI && window.NHAI.version) {
                    resultDiv.className = 'test-result success'
                    resultDiv.innerHTML = `
                        <strong>✅ 框架加载成功！</strong><br>
                        版本: ${window.NHAI.version}<br>
                        组件数量: ${Object.keys(window.NHAI.Components).length}<br>
                        动态组件系统: ${window.NHAI.DynamicComponents ? '已加载' : '未加载'}
                    `
                } else {
                    throw new Error('NHAI 框架未正确加载')
                }
            } catch (error) {
                resultDiv.className = 'test-result error'
                resultDiv.innerHTML = `<strong>❌ 框架加载失败:</strong> ${error.message}`
            }
        }
        
        window.testComponentCreation = function() {
            const resultDiv = document.getElementById('component-result')
            resultDiv.style.display = 'block'
            
            try {
                // 测试按钮组件
                const button = new window.NHAI.Components.Button({
                    children: '测试按钮',
                    onClick: () => alert('按钮被点击了！')
                })
                
                const buttonElement = window.NHAI.Utils.renderComponent(button)
                buttonElement.style.margin = '10px'
                
                // 测试文本按钮组件
                const textButton = new window.NHAI.Components.TextButton({
                    children: '测试文本按钮',
                    onClick: () => alert('文本按钮被点击了！')
                })
                
                const textButtonElement = window.NHAI.Utils.renderComponent(textButton)
                textButtonElement.style.margin = '10px'
                
                resultDiv.className = 'test-result success'
                resultDiv.innerHTML = `
                    <strong>✅ 组件创建成功！</strong><br>
                    已创建按钮组件和文本按钮组件
                `
                resultDiv.appendChild(buttonElement)
                resultDiv.appendChild(textButtonElement)
                
            } catch (error) {
                resultDiv.className = 'test-result error'
                resultDiv.innerHTML = `<strong>❌ 组件创建失败:</strong> ${error.message}`
            }
        }
        
        window.testDynamicComponents = function() {
            const resultDiv = document.getElementById('dynamic-result')
            resultDiv.style.display = 'block'
            
            try {
                // 注册动态组件
                window.NHAI.DynamicComponents.Registry.registerComponent('CustomButton', class {
                    constructor(props) {
                        this.props = props
                    }
                    
                    render() {
                        return {
                            tag: 'button',
                            props: {
                                ...this.props,
                                style: {
                                    padding: '10px 20px',
                                    backgroundColor: '#28a745',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '6px',
                                    cursor: 'pointer',
                                    ...this.props.style
                                }
                            },
                            children: this.props.children || '动态按钮'
                        }
                    }
                })
                
                // 创建动态组件
                const dynamicComponent = window.NHAI.DynamicComponents.Renderer.renderDynamicComponent('CustomButton', {
                    children: '动态创建的按钮',
                    onClick: () => alert('动态按钮被点击了！')
                })
                
                const dynamicElement = window.NHAI.Utils.createElement(
                    dynamicComponent.tag, 
                    dynamicComponent.props, 
                    dynamicComponent.children
                )
                dynamicElement.style.margin = '10px'
                
                resultDiv.className = 'test-result success'
                resultDiv.innerHTML = `
                    <strong>✅ 动态组件测试成功！</strong><br>
                    已注册并创建动态组件
                `
                resultDiv.appendChild(dynamicElement)
                
            } catch (error) {
                resultDiv.className = 'test-result error'
                resultDiv.innerHTML = `<strong>❌ 动态组件测试失败:</strong> ${error.message}`
            }
        }
        
        window.testPerformance = function() {
            const resultDiv = document.getElementById('performance-result')
            resultDiv.style.display = 'block'
            
            try {
                const startTime = performance.now()
                
                // 创建大量组件测试性能
                const components = []
                for (let i = 0; i < 100; i++) {
                    const button = new window.NHAI.Components.Button({
                        children: `按钮 ${i + 1}`,
                        onClick: () => console.log(`按钮 ${i + 1} 被点击`)
                    })
                    components.push(button)
                }
                
                const endTime = performance.now()
                const duration = endTime - startTime
                
                resultDiv.className = 'test-result success'
                resultDiv.innerHTML = `
                    <strong>✅ 性能测试完成！</strong><br>
                    创建 100 个组件耗时: ${duration.toFixed(2)}ms<br>
                    平均每个组件: ${(duration / 100).toFixed(2)}ms<br>
                    性能评级: ${duration < 10 ? '优秀' : duration < 50 ? '良好' : '一般'}
                `
                
            } catch (error) {
                resultDiv.className = 'test-result error'
                resultDiv.innerHTML = `<strong>❌ 性能测试失败:</strong> ${error.message}`
            }
        }
        
        window.testBrowserCompatibility = function() {
            const resultDiv = document.getElementById('compatibility-result')
            resultDiv.style.display = 'block'
            
            try {
                const features = {
                    'ES6 Classes': typeof class {} === 'function',
                    'Arrow Functions': (() => true)(),
                    'Template Literals': `test` === 'test',
                    'Destructuring': (() => { const {a} = {a: 1}; return a === 1 })(),
                    'Map': typeof Map === 'function',
                    'Promise': typeof Promise === 'function',
                    'Fetch': typeof fetch === 'function',
                    'Local Storage': typeof localStorage !== 'undefined',
                    'Session Storage': typeof sessionStorage !== 'undefined'
                }
                
                const supportedFeatures = Object.values(features).filter(Boolean).length
                const totalFeatures = Object.keys(features).length
                const compatibility = (supportedFeatures / totalFeatures * 100).toFixed(1)
                
                const featureList = Object.entries(features)
                    .map(([name, supported]) => 
                        `<li style="color: ${supported ? '#28a745' : '#dc3545'}">
                            ${supported ? '✅' : '❌'} ${name}
                        </li>`
                    ).join('')
                
                resultDiv.className = 'test-result success'
                resultDiv.innerHTML = `
                    <strong>✅ 浏览器兼容性测试完成！</strong><br>
                    兼容性评分: ${compatibility}%<br>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${featureList}
                    </ul>
                `
                
            } catch (error) {
                resultDiv.className = 'test-result error'
                resultDiv.innerHTML = `<strong>❌ 兼容性测试失败:</strong> ${error.message}`
            }
        }
        
        // 页面加载完成后自动运行基础测试
        document.addEventListener('DOMContentLoaded', function() {
            console.log('NHAI 框架测试页面已加载')
            console.log('NHAI 版本:', window.NHAI.version)
        })
    </script>
</body>
</html>
